{% extends "configurator/base.html" %}
{% load static %}

{% block configurator_content %}
    <div class="container">
        <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä -->
        <div class="progress mb-4" style="height: 20px;">
            <div class="progress-bar bg-success"
                 role="progressbar"
                 style="width: {{ progress }}%">
                –®–∞–≥ {{ step }} –∏–∑ 3
            </div>
        </div>

        <div class="row">
            <!-- –ë–ª–æ–∫ —Ç–µ–∫—É—â–µ–π —Å–±–æ—Ä–∫–∏ -->
            <div class="col-md-4 mb-4">
                <div class="card shadow">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">üõ† –¢–µ–∫—É—â–∞—è —Å–±–æ—Ä–∫–∞</h5>
                    </div>
                    <div class="card-body">
                        {% if selected_components %}
                            <div class="components-preview">
                                {% for component in selected_components %}
                                    <div class="d-flex align-items-center mb-3
                                {% if component.has_conflict %}border border-danger{% endif %}">
                                        <div class="flex-shrink-0">
                                            {% if component.has_conflict %}
                                                <span class="text-danger me-2">‚ö†</span>
                                            {% else %}
                                                <span class="text-success me-2">‚úì</span>
                                            {% endif %}
                                        </div>
                                        <div class="flex-grow-1">
                                            <div class="fw-bold">{{ component.product.name }}</div>
                                            <small class="text-muted">{{ component.product.category.name }}</small>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        {% else %}
                            <div class="alert alert-info mb-0">
                                –í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–≤—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Å–±–æ—Ä–∫—É
                            </div>
                        {% endif %}
                    </div>
                    <div class="card-footer text-muted small">
                        –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:
                        <span class="badge
                        {% if total_conflicts == 0 %}bg-success{% else %}bg-danger{% endif %}">
                        {{ total_conflicts }} –æ—à–∏–±–æ–∫
                    </span>
                    </div>
                </div>
            </div>

            <!-- –ë–ª–æ–∫ –≤—ã–±–æ—Ä–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π -->
            <div class="col-md-8">
                <h4 class="mb-4">üì¶ –í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è</h4>
                <div class="row row-cols-1 row-cols-md-2 g-4">
                    {% for category in categories %}
                        <div class="col">
                            <a href="{% url 'configurator:select_component' category.slug %}"
                               class="card category-card text-decoration-none
                            {% if category.slug in selected_categories_slugs %}
                                {% if category.has_conflict %}border-danger{% else %}border-success{% endif %}
                            {% else %}border-secondary{% endif %}">
                                <div class="card-body">
                                    <div class="d-flex align-items-center">
                                        <div class="flex-shrink-0 me-3">
                                            {% if category.image %}
                                                <img src="{{ category.image.url }}"
                                                     alt="{{ category.name }}"
                                                     class="img-fluid rounded"
                                                     style="width: 60px;">
                                            {% else %}
                                                <!-- –ó–∞–≥–ª—É—à–∫–∞, –µ—Å–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç -->
                                                <img src="{% static 'configurator/img/default-category.png' %}"
                                                     alt="no-img"
                                                     class="img-fluid rounded"
                                                     style="width: 40px;">
                                            {% endif %}
                                        </div>
                                        <div class="flex-grow-1">
                                            <h5 class="card-title mb-1">{{ category.name }}</h5>
                                            <small class="text-muted">
                                                {% if category.slug in selected_categories_slugs %}
                                                    {% if category.has_conflict %}
                                                        <span class="text-danger">–¢—Ä–µ–±—É–µ—Ç—Å—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</span>
                                                    {% else %}
                                                        <span class="text-success">–í—ã–±—Ä–∞–Ω–æ</span>
                                                    {% endif %}
                                                {% else %}
                                                    –ù–µ –≤—ã–±—Ä–∞–Ω–æ
                                                {% endif %}
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </a>
                        </div>
                    {% empty %}
                        <div class="col-12">
                            <div class="alert alert-warning">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã</div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block css %}
    <style>
        .category-card {
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .category-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
        }

        .components-preview {
            max-height: 400px;
            overflow-y: auto;
        }
    </style>
{% endblock %}