{% extends "base.html" %}
{% load static %}

{% block extra_styles %}
<link rel="stylesheet" href="{% static 'compare/css/comparison.css' %}">
{% endblock %}

{% block content %}
<div class="ts-compare-container container py-5">
    <div class="ts-compare-header d-flex justify-content-between align-items-center mb-4">
        <h1 class="ts-compare-title text-primary-700">
            <i class="bi bi-clipboard2-data me-2"></i>Сравнение товаров
        </h1>
        <a href="{% url 'products:catalog' %}" class="ts-compare-add-btn btn btn-outline-primary">
            <i class="bi bi-plus-lg me-2"></i>Добавить товар
        </a>
    </div>

    {% if products %}
    <div class="ts-compare-table-wrapper table-responsive">
        <table class="table ts-compare-table">
            <thead>
                <tr>
                    <th class="ts-compare-param-header ps-4">Характеристики</th>
                    {% for product in products %}
                    <th class="ts-compare-product-header position-relative">
                        <div class="ts-compare-product-card">
                            <button class="ts-compare-remove-btn btn btn-danger btn-icon"
                                    data-product-id="{{ product.id }}"
                                    aria-label="Удалить из сравнения">
                                <i class="bi bi-x-lg"></i>
                            </button>
                            <img src="{{ product.get_first_image.image.url }}"
                                 alt="{{ product.name }}"
                                 class="ts-compare-product-img img-fluid">
                            <h5 class="ts-compare-product-title text-primary-700 mt-2 mb-1">{{ product.name }}</h5>
                            <div class="ts-compare-product-price text-primary-500 fw-bold">{{ product.price }} ₽</div>
                        </div>
                    </th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for group, params in specs.items %}
                <tr class="ts-compare-group-header">
                    <td colspan="{{ products|length|add:1 }}" class="ps-4">
                        <i class="bi bi-folder2-open me-2"></i>{{ group }}
                    </td>
                </tr>
                {% for param, values in params.items %}
                <tr class="ts-compare-param-row">
                    <td class="ts-compare-param-name ps-4 text-neutral-600">{{ param }}</td>
                    {% for value in values %}
                    <td class="ts-compare-param-value {% if value != values.0 %}ts-compare-diff{% endif %}">
                        <span class="text-neutral-700">{{ value|default:"—" }}</span>
                    </td>
                    {% endfor %}
                </tr>
                {% endfor %}
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="ts-compare-empty card border-2 border-dashed border-primary-200 text-center py-5">
        <div class="card-body">
            <div class="ts-compare-empty-icon text-primary-500 mb-4">
                <i class="bi bi-clipboard2-x fs-1"></i>
            </div>
            <h2 class="ts-compare-empty-title text-primary-700 mb-3">Нет товаров для сравнения</h2>
            <p class="ts-compare-empty-text text-neutral-600 mb-4">Добавьте минимум два товара из каталога</p>
            <a href="{% url 'products:catalog' %}" class="ts-compare-empty-btn btn btn-primary px-5">
                <i class="bi bi-arrow-right-circle me-2"></i>Выбрать товары
            </a>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}